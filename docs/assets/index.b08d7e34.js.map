{"version":3,"file":"index.b08d7e34.js","sources":["../../src/views/File/data.js","../../src/views/File/index.vue","../../src/utils/index.js"],"sourcesContent":["import dayjs from \"dayjs\";\n\nconst downloadUrl =\n  process.env.NODE_ENV === \"production\"\n    ? `https://raw.githubusercontent.com/sonicsunsky/airport-file/main/docs/pdf/compressed.tracemonkey-pldi-09.pdf`\n    : `http://localhost:3000/pdf/compressed.tracemonkey-pldi-09.pdf`;\n\nexport const createTableData = (size) => {\n  return new Array(size).fill(\"\").map((item, index) => {\n    return {\n      id: index + 1,\n      role: Math.random() > 0.5 ? \"admin\" : \"visitor\",\n      name: `机场文件${index + 1}`,\n      status: Math.random() > 0.5 ? \"read\" : \"unread\",\n      date: dayjs().format(\"YYYY-MM-DD HH:mm:ss\"), //YYYY-MM-DD HH:mm:ss\n      mime: `application/pdf`,\n      download_url: downloadUrl, //files[index % 4],\n      href: downloadUrl,\n    };\n  });\n};\n\nexport const treeData = [\n  {\n    label: \"文件一级 1\",\n    children: [\n      {\n        label: \"文件二级 1-1\",\n        children: [\n          {\n            label: \"文件三级 1-1-1\",\n          },\n        ],\n      },\n    ],\n  },\n  {\n    label: \"文件一级 2\",\n    children: [\n      {\n        label: \"文件二级 2-1\",\n        children: [\n          {\n            label: \"文件三级 2-1-1\",\n          },\n        ],\n      },\n      {\n        label: \"文件二级 2-2\",\n        children: [\n          {\n            label: \"文件三级 2-2-1\",\n          },\n        ],\n      },\n    ],\n  },\n  {\n    label: \"文件一级 3\",\n    children: [\n      {\n        label: \"文件二级 3-1\",\n        children: [\n          {\n            label: \"文件三级 3-1-1\",\n          },\n        ],\n      },\n      {\n        label: \"文件二级 3-2\",\n        children: [\n          {\n            label: \"文件三级 3-2-1\",\n          },\n        ],\n      },\n    ],\n  },\n];\n","<template>\n  <div class=\"file\">\n    <el-dialog\n      title=\"免责声明弹窗\"\n      v-model=\"showDisclaimer\"\n      width=\"50%\"\n      center\n      :show-close=\"false\"\n      :close-on-press-escape=\"false\"\n      :close-on-click-modal=\"false\"\n    >\n      <div class=\"disclaimer\">\n        <span>\n          免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明\n          免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明\n        </span>\n      </div>\n      <template #footer>\n        <div class=\"disclaimer-footer\">\n          <el-button type=\"primary\" @click=\"showDisclaimer = false\"\n            >接受以上免责声明</el-button\n          >\n        </div>\n      </template>\n    </el-dialog>\n\n    <el-dialog title=\"PDF预览\" v-model=\"showPDFViewer\" width=\"90%\" center>\n      <div class=\"pdf\">\n        <iframe :src=\"pdfSrc\" width=\"400\" height=\"400\"></iframe>\n        <!-- <pdf v-for=\"i in numPages\" :key=\"i\" :src=\"pdfSrc\" :page=\"i\"></pdf> -->\n      </div>\n    </el-dialog>\n\n    <template v-if=\"device === 'mobile'\">\n      <div class=\"lay-mobile\">\n        <el-tree\n          accordion\n          default-expand-all\n          :expand-on-click-node=\"false\"\n          :data=\"catalogData\"\n          :props=\"defaultProps\"\n          @node-click=\"handleTreeNodeClick\"\n        ></el-tree>\n\n        <div class=\"search-input\">\n          <div class=\"title\">文件搜索</div>\n          <el-input\n            v-model=\"keyword\"\n            placeholder=\"请输入查询文件的名称\"\n            @keyup.enter=\"onSearchFileList\"\n          >\n            <template #append>\n              <el-button\n                icon=\"el-icon-search\"\n                @click=\"onSearchFileList\"\n              ></el-button>\n            </template>\n          </el-input>\n        </div>\n\n        <div class=\"file-table\">\n          <el-table\n            v-loading=\"tableLoading\"\n            element-loading-text=\"文件加载中\"\n            element-loading-spinner=\"el-icon-loading\"\n            :data=\"fileList\"\n            stripe\n            style=\"width: 100%\"\n            max-height=\"1000px\"\n          >\n            <el-table-column prop=\"name\" label=\"文件名称\"></el-table-column>\n            <el-table-column label=\"是否已读\">\n              <template #default=\"{ row }\">\n                <el-tag :type=\"row.status === 'read' ? 'success' : 'danger'\">{{\n                  row.status === \"read\" ? \"已读\" : \"未读\"\n                }}</el-tag>\n              </template>\n            </el-table-column>\n\n            <el-table-column prop=\"date\" label=\"上传时间\"></el-table-column>\n\n            <el-table-column label=\"操作\">\n              <template #default=\"{ row }\">\n                <el-button\n                  type=\"text\"\n                  icon=\"el-icon-view\"\n                  @click=\"openFileDetail\"\n                >\n                  查看详情\n                </el-button>\n\n                <el-button\n                  v-if=\"row.role === 'admin'\"\n                  icon=\"el-icon-download\"\n                  type=\"text\"\n                  @click=\"handleDownloadFile(row)\"\n                  >下载</el-button\n                >\n              </template>\n            </el-table-column>\n          </el-table>\n        </div>\n\n        <el-pagination\n          v-show=\"total > 0\"\n          background\n          v-model:page-size=\"listQuery.limit\"\n          :page-sizes=\"[10, 20, 30, 50]\"\n          v-model:currentPage=\"listQuery.page\"\n          layout=\"prev, pager, next\"\n          :total=\"total\"\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n        >\n        </el-pagination>\n      </div>\n    </template>\n\n    <template v-else>\n      <div class=\"lay-pc\">\n        <el-row type=\"flex\" :gutter=\"10\">\n          <el-col :xs=\"8\" :sm=\"8\" :md=\"6\" :lg=\"6\" :xl=\"6\">\n            <el-tree\n              accordion\n              default-expand-all\n              :expand-on-click-node=\"false\"\n              :data=\"catalogData\"\n              :props=\"defaultProps\"\n              @node-click=\"handleTreeNodeClick\"\n            ></el-tree>\n          </el-col>\n\n          <el-col :xs=\"16\" :sm=\"16\" :md=\"18\" :lg=\"18\" :xl=\"18\">\n            <div class=\"search-input\">\n              <div class=\"title\">文件搜索</div>\n              <el-input\n                v-model=\"keyword\"\n                placeholder=\"请输入查询文件的名称\"\n                @keyup.enter=\"onSearchFileList\"\n              >\n                <template #append>\n                  <el-button\n                    icon=\"el-icon-search\"\n                    @click=\"onSearchFileList\"\n                  ></el-button>\n                </template>\n              </el-input>\n            </div>\n\n            <div class=\"file-table\">\n              <el-table\n                v-loading=\"tableLoading\"\n                element-loading-text=\"文件加载中\"\n                element-loading-spinner=\"el-icon-loading\"\n                :data=\"fileList\"\n                stripe\n                style=\"width: 100%\"\n                max-height=\"1000px\"\n              >\n                <el-table-column prop=\"name\" label=\"文件名称\"></el-table-column>\n                <el-table-column label=\"是否已读\">\n                  <template #default=\"{ row }\">\n                    <el-tag\n                      :type=\"row.status === 'read' ? 'success' : 'danger'\"\n                      >{{ row.status === \"read\" ? \"已读\" : \"未读\" }}</el-tag\n                    >\n                  </template>\n                </el-table-column>\n\n                <el-table-column prop=\"date\" label=\"上传时间\"></el-table-column>\n\n                <el-table-column label=\"操作\">\n                  <template #default=\"{ row }\">\n                    <el-button\n                      type=\"text\"\n                      icon=\"el-icon-view\"\n                      @click=\"openFileDetail(row)\"\n                      >查看详情</el-button\n                    >\n\n                    <el-button\n                      v-if=\"row.role === 'admin'\"\n                      icon=\"el-icon-download\"\n                      type=\"text\"\n                      @click=\"handleDownloadFile(row)\"\n                      >下载</el-button\n                    >\n                  </template>\n                </el-table-column>\n              </el-table>\n            </div>\n\n            <el-pagination\n              v-show=\"total > 0\"\n              background\n              v-model:page-size=\"listQuery.limit\"\n              :page-sizes=\"[10, 20, 30, 50]\"\n              v-model:currentPage=\"listQuery.page\"\n              layout=\"total, sizes, prev, pager, next, jumper\"\n              :total=\"total\"\n              @size-change=\"handleSizeChange\"\n              @current-change=\"handleCurrentChange\"\n            >\n            </el-pagination>\n          </el-col>\n        </el-row>\n      </div>\n    </template>\n  </div>\n</template>\n\n<script>\nimport {\n  computed,\n  defineComponent,\n  onMounted,\n  reactive,\n  toRefs,\n  getCurrentInstance,\n} from \"vue\";\nimport { useRoute, useRouter } from \"vue-router\";\nimport { useStore } from \"vuex\";\nimport { treeData, createTableData } from \"./data\";\nimport { downloadFile } from \"@/utils\";\n\nexport default defineComponent({\n  name: \"File\",\n  // components: {\n  //   pdf,\n  // },\n  setup() {\n    console.log(\"getCurrentInstance: \", getCurrentInstance());\n    const router = useRouter();\n    const route = useRoute();\n    const store = useStore();\n\n    const state = reactive({\n      showDisclaimer: true,\n      showPDFViewer: false,\n      pdfSrc: \"\",\n      numPages: 0,\n      keyword: \"\",\n      defaultProps: {\n        children: \"children\",\n        label: \"label\",\n      },\n      catalogData: [],\n      total: 0,\n      listQuery: {\n        page: 1,\n        limit: 10,\n      },\n      tableLoading: false,\n      fileList: [],\n      //通过 Scoped slot 可以获取到 row, column, $index 和 store（table 内部的状态管理）的数据\n    });\n\n    const device = computed(() => store.getters[\"settings/device\"]);\n\n    onMounted(() => {\n      state.catalogData = [...treeData];\n      state.total = 100;\n      generateTableData();\n    });\n\n    const handleSizeChange = (val) => {\n      state.listQuery.limit = val;\n      fetchFileList();\n    };\n\n    const handleCurrentChange = (val) => {\n      state.listQuery.page = val;\n      fetchFileList();\n    };\n\n    const fetchFileList = () => {\n      state.keyword = \"\";\n      generateTableData();\n      // getFileList();\n    };\n\n    const generateTableData = () => {\n      state.tableLoading = true;\n      const size = Math.floor(Math.random() * 10 + 1);\n      console.log(size);\n      setTimeout(() => {\n        const list = createTableData(size);\n        state.fileList = [...list];\n        state.tableLoading = false;\n      }, 500);\n    };\n\n    const handleTreeNodeClick = (e) => {\n      console.log(e);\n      generateTableData();\n    };\n\n    const onSearchFileList = () => {\n      if (state.keyword.trim() === \"\") return;\n      generateTableData();\n      // getFileList();\n    };\n\n    const openFileDetail = ({ href }) => {\n      // if (href) {\n      //   window.open(href, \"_blank\");\n      // }\n      router.push({ path: \"/pdf\", query: { href } });\n      // state.pdfSrc = href;\n      // state.showPDFViewer = true;\n      // state.pdfSrc = pdf.createLoadingTask(state.pdfSrc);\n      // state.pdfSrc.promise.then((res) => {\n      //   state.numPages = res.numPages;\n      // });\n    };\n\n    const handleDownloadFile = ({ download_url, name, mime }) => {\n      downloadFile(download_url, name);\n      // Api.downloadFile(download_url, name, mime);\n    };\n\n    const loadNode = (node, resolve) => {\n      if (node.level === 0) {\n        return resolve([{ name: \"region1\" }, { name: \"region2\" }]);\n      }\n      if (node.level > 3) return resolve([]);\n\n      var hasChild;\n      if (node.data.name === \"region1\") {\n        hasChild = true;\n      } else if (node.data.name === \"region2\") {\n        hasChild = false;\n      } else {\n        hasChild = Math.random() > 0.5;\n      }\n\n      setTimeout(() => {\n        var data;\n        if (hasChild) {\n          data = [\n            {\n              name: \"zone\" + state.count++,\n            },\n            {\n              name: \"zone\" + state.count++,\n            },\n          ];\n        } else {\n          data = [];\n        }\n\n        resolve(data);\n      }, 500);\n    };\n\n    return {\n      ...toRefs(state),\n      device,\n      openFileDetail,\n      handleDownloadFile,\n      onSearchFileList,\n      fetchFileList,\n      handleSizeChange,\n      handleCurrentChange,\n      handleTreeNodeClick,\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"./index.scss\";\n</style>\n","export function downloadFile(url, name) {\n  let eLink = document.createElement(\"a\");\n  eLink.style.display = \"none\";\n  eLink.href = url;\n  eLink.setAttribute(\"download\", name); //设置下载属性 以及文件名\n  document.body.appendChild(eLink);\n  eLink.click();\n  document.body.removeChild(eLink);\n}\n"],"names":["downloadUrl","treeData","label","children","defineComponent","name","[object Object]","log","getCurrentInstance","router","useRouter","store","useStore","state","reactive","showDisclaimer","showPDFViewer","pdfSrc","numPages","keyword","defaultProps","catalogData","total","listQuery","page","limit","tableLoading","fileList","device","computed","getters","fetchFileList","generateTableData","size","Math","floor","random","list","Array","fill","map","item","index","id","role","status","date","dayjs","format","mime","download_url","href","createTableData","toRefs","openFileDetail","push","path","query","handleDownloadFile","url","eLink","document","createElement","style","display","setAttribute","body","appendChild","click","removeChild","onSearchFileList","trim","handleSizeChange","val","handleCurrentChange","handleTreeNodeClick","e","key","onUpdate:modelValue","width","center","show-close","close-on-press-escape","type","src","_ctx","_createBlock","_component_el_tree","accordion","default-expand-all","expand-on-click-node","data","props","_hoisted_8","placeholder","icon","element-loading-text","element-loading-spinner","stripe","prop","_createVNode","background","onUpdate:page-size","page-sizes","onUpdate:currentPage","layout","onSizeChange","xs","sm","md","lg","_hoisted_14"],"mappings":"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"}