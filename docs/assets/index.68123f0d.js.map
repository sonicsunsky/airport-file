{"version":3,"file":"index.68123f0d.js","sources":["../../src/views/File/data.js","../../src/views/File/index.vue"],"sourcesContent":["import dayjs from \"dayjs\";\n\nexport const createTableData = (size) => {\n  return new Array(size).fill(\"\").map((item, index) => {\n    return {\n      id: index + 1,\n      role: Math.random() > 0.5 ? \"admin\" : \"visitor\",\n      name: `机场文件${index + 1}`,\n      status: Math.random() > 0.5 ? \"read\" : \"unread\",\n      date: dayjs().format(\"YYYY-MM-DD HH:mm:ss\"), //YYYY-MM-DD HH:mm:ss\n      link: `http://www.leomay.com/upload/file/mmo-20170707165001.pdf`,\n      url: `http://www.pwithe.com/Public/Upload/download/20170211/589ebf8e5bb13.pdf`,\n    };\n  });\n};\n\nexport const treeData = [\n  {\n    label: \"文件一级 1\",\n    children: [\n      {\n        label: \"文件二级 1-1\",\n        children: [\n          {\n            label: \"文件三级 1-1-1\",\n          },\n        ],\n      },\n    ],\n  },\n  {\n    label: \"文件一级 2\",\n    children: [\n      {\n        label: \"文件二级 2-1\",\n        children: [\n          {\n            label: \"文件三级 2-1-1\",\n          },\n        ],\n      },\n      {\n        label: \"文件二级 2-2\",\n        children: [\n          {\n            label: \"文件三级 2-2-1\",\n          },\n        ],\n      },\n    ],\n  },\n  {\n    label: \"文件一级 3\",\n    children: [\n      {\n        label: \"文件二级 3-1\",\n        children: [\n          {\n            label: \"文件三级 3-1-1\",\n          },\n        ],\n      },\n      {\n        label: \"文件二级 3-2\",\n        children: [\n          {\n            label: \"文件三级 3-2-1\",\n          },\n        ],\n      },\n    ],\n  },\n];\n","<template>\n  <div class=\"file\">\n    <el-dialog\n      title=\"免责声明弹窗\"\n      v-model=\"showDisclaimer\"\n      width=\"50%\"\n      center\n      :show-close=\"false\"\n      :close-on-press-escape=\"false\"\n      :close-on-click-modal=\"false\"\n    >\n      <div class=\"disclaimer\">\n        <span>\n          免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明\n          免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明免责声明\n        </span>\n      </div>\n      <template #footer>\n        <div class=\"disclaimer-footer\">\n          <el-button type=\"primary\" @click=\"showDisclaimer = false\"\n            >接受以上免责声明</el-button\n          >\n        </div>\n      </template>\n    </el-dialog>\n\n    <template v-if=\"device === 'mobile'\">\n      <div class=\"lay-mobile\">\n        <el-tree\n          accordion\n          default-expand-all\n          :expand-on-click-node=\"false\"\n          :data=\"catalogData\"\n          :props=\"defaultProps\"\n          @node-click=\"handleTreeNodeClick\"\n        ></el-tree>\n\n        <div class=\"search-input\">\n          <div class=\"title\">文件搜索</div>\n          <el-input\n            v-model=\"keyword\"\n            placeholder=\"请输入查询文件的名称\"\n            @keyup.enter=\"onSearchFileList\"\n          >\n            <template #append>\n              <el-button\n                icon=\"el-icon-search\"\n                @click=\"onSearchFileList\"\n              ></el-button>\n            </template>\n          </el-input>\n        </div>\n\n        <div class=\"file-table\">\n          <el-table\n            v-loading=\"tableLoading\"\n            element-loading-text=\"文件加载中\"\n            element-loading-spinner=\"el-icon-loading\"\n            :data=\"fileList\"\n            stripe\n            style=\"width: 100%\"\n            max-height=\"1000px\"\n          >\n            <el-table-column prop=\"name\" label=\"文件名称\"></el-table-column>\n            <el-table-column label=\"是否已读\">\n              <template #default=\"{ row }\">\n                <el-tag :type=\"row.status === 'read' ? 'success' : 'danger'\">{{\n                  row.status === \"read\" ? \"已读\" : \"未读\"\n                }}</el-tag>\n              </template>\n            </el-table-column>\n\n            <el-table-column prop=\"date\" label=\"上传时间\"></el-table-column>\n\n            <el-table-column label=\"操作\">\n              <template #default=\"{ row }\">\n                <el-button type=\"text\" @click=\"openFileDetail(row)\"\n                  >查看详情</el-button\n                >\n\n                <el-button\n                  v-if=\"row.role === 'admin'\"\n                  type=\"text\"\n                  @click=\"downloadFile(row)\"\n                  >下载</el-button\n                >\n              </template>\n            </el-table-column>\n          </el-table>\n        </div>\n\n        <el-pagination\n          v-show=\"total > 0\"\n          background\n          v-model:page-size=\"listQuery.limit\"\n          :page-sizes=\"[10, 20, 30, 50]\"\n          v-model:currentPage=\"listQuery.page\"\n          layout=\"prev, pager, next\"\n          :total=\"total\"\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n        >\n        </el-pagination>\n      </div>\n    </template>\n\n    <template v-else>\n      <div class=\"lay-pc\">\n        <el-row type=\"flex\" :gutter=\"10\">\n          <el-col :xs=\"8\" :sm=\"8\" :md=\"6\" :lg=\"6\" :xl=\"6\">\n            <el-tree\n              accordion\n              default-expand-all\n              :expand-on-click-node=\"false\"\n              :data=\"catalogData\"\n              :props=\"defaultProps\"\n              @node-click=\"handleTreeNodeClick\"\n            ></el-tree>\n          </el-col>\n\n          <el-col :xs=\"16\" :sm=\"16\" :md=\"18\" :lg=\"18\" :xl=\"18\">\n            <div class=\"search-input\">\n              <div class=\"title\">文件搜索</div>\n              <el-input\n                v-model=\"keyword\"\n                placeholder=\"请输入查询文件的名称\"\n                @keyup.enter=\"onSearchFileList\"\n              >\n                <template #append>\n                  <el-button\n                    icon=\"el-icon-search\"\n                    @click=\"onSearchFileList\"\n                  ></el-button>\n                </template>\n              </el-input>\n            </div>\n\n            <div class=\"file-table\">\n              <el-table\n                v-loading=\"tableLoading\"\n                element-loading-text=\"文件加载中\"\n                element-loading-spinner=\"el-icon-loading\"\n                :data=\"fileList\"\n                stripe\n                style=\"width: 100%\"\n                max-height=\"1000px\"\n              >\n                <el-table-column prop=\"name\" label=\"文件名称\"></el-table-column>\n                <el-table-column label=\"是否已读\">\n                  <template #default=\"{ row }\">\n                    <el-tag\n                      :type=\"row.status === 'read' ? 'success' : 'danger'\"\n                      >{{ row.status === \"read\" ? \"已读\" : \"未读\" }}</el-tag\n                    >\n                  </template>\n                </el-table-column>\n\n                <el-table-column prop=\"date\" label=\"上传时间\"></el-table-column>\n\n                <el-table-column label=\"操作\">\n                  <template #default=\"{ row }\">\n                    <el-button type=\"text\" @click=\"openFileDetail(row)\"\n                      >查看详情</el-button\n                    >\n\n                    <el-button\n                      v-if=\"row.role === 'admin'\"\n                      type=\"text\"\n                      @click=\"downloadFile(row)\"\n                      >下载</el-button\n                    >\n                  </template>\n                </el-table-column>\n              </el-table>\n            </div>\n\n            <el-pagination\n              v-show=\"total > 0\"\n              background\n              v-model:page-size=\"listQuery.limit\"\n              :page-sizes=\"[10, 20, 30, 50]\"\n              v-model:currentPage=\"listQuery.page\"\n              layout=\"total, sizes, prev, pager, next, jumper\"\n              :total=\"total\"\n              @size-change=\"handleSizeChange\"\n              @current-change=\"handleCurrentChange\"\n            >\n            </el-pagination>\n          </el-col>\n        </el-row>\n      </div>\n    </template>\n  </div>\n</template>\n\n<script>\nimport {\n  computed,\n  defineComponent,\n  onMounted,\n  onUnmounted,\n  reactive,\n  toRefs,\n} from \"vue\";\nimport { useRoute, useRouter } from \"vue-router\";\nimport { useStore } from \"vuex\";\nimport { treeData, createTableData } from \"./data\";\n\nexport default defineComponent({\n  name: \"File\",\n  setup() {\n    const router = useRouter();\n    const route = useRoute();\n    const store = useStore();\n\n    const state = reactive({\n      showDisclaimer: true,\n      keyword: \"\",\n      defaultProps: {\n        children: \"children\",\n        label: \"label\",\n      },\n      catalogData: [],\n      total: 0,\n      listQuery: {\n        page: 1,\n        limit: 10,\n      },\n      tableLoading: false,\n      fileList: [],\n      //通过 Scoped slot 可以获取到 row, column, $index 和 store（table 内部的状态管理）的数据\n    });\n\n    const device = computed(() => store.getters[\"settings/device\"]);\n\n    onMounted(() => {\n      state.catalogData = [...treeData];\n      state.total = 100;\n      generateTableData();\n    });\n\n    onUnmounted(() => {});\n\n    const handleSizeChange = (val) => {\n      state.listQuery.limit = val;\n      fetchFileList();\n    };\n\n    const handleCurrentChange = (val) => {\n      state.listQuery.page = val;\n      fetchFileList();\n    };\n\n    const fetchFileList = () => {\n      state.keyword = \"\";\n      generateTableData();\n      // getFileList();\n    };\n\n    const generateTableData = () => {\n      state.tableLoading = true;\n      const size = Math.floor(Math.random() * 10 + 1);\n      console.log(size);\n      setTimeout(() => {\n        const list = createTableData(size);\n        state.fileList = [...list];\n        state.tableLoading = false;\n      }, 500);\n    };\n\n    const handleTreeNodeClick = (e) => {\n      console.log(e);\n      generateTableData();\n    };\n\n    const onSearchFileList = () => {\n      if (state.keyword.trim() === \"\") return;\n      generateTableData();\n      // getFileList();\n    };\n\n    const openFileDetail = ({ url }) => {\n      if (url) {\n        window.open(url, \"_blank\");\n      }\n    };\n\n    const downloadFile = ({ link }) => {\n      if (link) {\n        window.open(link, \"_blank\");\n      }\n    };\n\n    const loadNode = (node, resolve) => {\n      if (node.level === 0) {\n        return resolve([{ name: \"region1\" }, { name: \"region2\" }]);\n      }\n      if (node.level > 3) return resolve([]);\n\n      var hasChild;\n      if (node.data.name === \"region1\") {\n        hasChild = true;\n      } else if (node.data.name === \"region2\") {\n        hasChild = false;\n      } else {\n        hasChild = Math.random() > 0.5;\n      }\n\n      setTimeout(() => {\n        var data;\n        if (hasChild) {\n          data = [\n            {\n              name: \"zone\" + state.count++,\n            },\n            {\n              name: \"zone\" + state.count++,\n            },\n          ];\n        } else {\n          data = [];\n        }\n\n        resolve(data);\n      }, 500);\n    };\n\n    return {\n      ...toRefs(state),\n      device,\n      openFileDetail,\n      downloadFile,\n      onSearchFileList,\n      fetchFileList,\n      handleSizeChange,\n      handleCurrentChange,\n      handleTreeNodeClick,\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"./index.scss\";\n</style>\n"],"names":["treeData","label","children","defineComponent","name","[object Object]","store","useStore","state","reactive","showDisclaimer","keyword","defaultProps","catalogData","total","listQuery","page","limit","tableLoading","fileList","device","computed","getters","fetchFileList","generateTableData","size","Math","floor","random","log","list","Array","fill","map","item","index","id","role","status","date","dayjs","format","link","url","createTableData","toRefs","openFileDetail","open","downloadFile","onSearchFileList","trim","handleSizeChange","val","handleCurrentChange","handleTreeNodeClick","e","key","onUpdate:modelValue","width","center","show-close","close-on-press-escape","type","_createBlock","_component_el_tree","accordion","default-expand-all","expand-on-click-node","data","props","_hoisted_7","placeholder","icon","element-loading-text","element-loading-spinner","_ctx","stripe","style","prop","_createVNode","background","onUpdate:page-size","page-sizes","onUpdate:currentPage","layout","onSizeChange","xs","sm","md","lg","_hoisted_13"],"mappings":"wfAEO,MAcMA,EAAW,CACtB,CACEC,MAAO,SACPC,SAAU,CACR,CACED,MAAO,WACPC,SAAU,CACR,CACED,MAAO,kBAMjB,CACEA,MAAO,SACPC,SAAU,CACR,CACED,MAAO,WACPC,SAAU,CACR,CACED,MAAO,gBAIb,CACEA,MAAO,WACPC,SAAU,CACR,CACED,MAAO,kBAMjB,CACEA,MAAO,SACPC,SAAU,CACR,CACED,MAAO,WACPC,SAAU,CACR,CACED,MAAO,gBAIb,CACEA,MAAO,WACPC,SAAU,CACR,CACED,MAAO,mBC8Id,QAAaE,GAChBC,KAAM,OACNC,sBAGQC,EAAQC,IAERC,EAAQC,EAAS,CACrBC,gBAAgB,EAChBC,QAAS,GACTC,aAAc,CACZV,SAAU,WACVD,MAAO,SAETY,YAAa,GACbC,MAAO,EACPC,UAAW,CACTC,KAAM,EACNC,MAAO,IAETC,cAAc,EACdC,SAAU,KAINC,EAASC,GAAS,IAAMf,EAAMgB,QAAQ,wBAElC,OACFT,YAAc,IAAIb,KAClBc,MAAQ,cAIJ,eAYNS,EAAgB,OACdZ,QAAU,QAKZa,EAAoB,OAClBN,cAAe,QACfO,EAAOC,KAAKC,MAAsB,GAAhBD,KAAKE,SAAgB,WACrCC,IAAIJ,eACD,WACHK,EDtQiB,CAACL,GACvB,IAAIM,MAAMN,GAAMO,KAAK,IAAIC,KAAI,CAACC,EAAMC,KAClC,CACLC,GAAID,EAAQ,EACZE,KAAMX,KAAKE,SAAW,GAAM,QAAU,UACtCxB,KAAM,OAAO+B,EAAQ,IACrBG,OAAQZ,KAAKE,SAAW,GAAM,OAAS,SACvCW,KAAMC,IAAQC,OAAO,uBACrBC,KAAM,2DACNC,IAAK,8EC6PUC,CAAgBnB,KACvBN,SAAW,IAAIW,KACfZ,cAAe,IACpB,sIA6DA2B,EAAOrC,UADL,CAELY,OAAAA,EACA0B,eAjDqB,EAAGH,IAAAA,MACpBA,UACKI,KAAKJ,EAAK,WAgDnBK,aA5CmB,EAAGN,KAAAA,MAClBA,UACKK,KAAKL,EAAM,WA2CpBO,iBAzDuB,KACM,KAAzBzC,EAAMG,QAAQuC,aAyDlB3B,cAAAA,EACA4B,iBA3FwBC,MAClBrC,UAAUE,MAAQmC,OA2FxBC,oBAvF2BD,MACrBrC,UAAUC,KAAOoC,OAuFvBE,oBAlE2BC,YACnB1B,IAAI0B,iWApPPC,IAAK,oIAgFLA,IAAK,2GA8DO,mTApKjBC,yDACAC,YACCC,UACAC,gBACAC,qEASC,iBAC6BC,kKAgBlBC,aANTC,GACAC,aACCC,qBAAoB,GACpBC,0BACAC,mBACAC,gEAiBG,eAAA,2BAZJC,4BAEEb,kDACCc,uFAKIC,8HAULC,+BACCC,4CACDN,KAAMO,WACNC,UACAC,kEAE6BC,gNASAA,yEAIDhB,4EAKR,wCACdN,MACCM,wJAUCiB,KACFC,4CACPC,yDACOC,uBAAsB,iCAC9BC,0DACCC,2BACAtE,QAAWA,MACXuE,6KAyFMtB,gBAjFYD,KAAM,wCACRwB,GAAI,EAAIC,GAAI,EAAIC,GAAI,EAAIC,GAAI,2BAEzCzB,GACAC,aACCC,qBAAoB,GACpBC,0BACAC,mBACAC,6GAIaiB,GAAI,GAAKC,GAAI,GAAKC,GAAI,GAAKC,GAAI,6BAEhB,SAC7BC,4BAEEjC,kDACCc,uFAKIC,8HAULC,+BACCC,4CACDN,KAAMO,WACNC,UACAC,kEAE6BC,gNAUAA,yEAIDhB,4EAKR,wCACdN,MACCM,wJAUCiB,KACFC,4CACPC,yDACOC,uBAAsB,iCAC9BC,0DACCC,iDACAtE,QAAWA,MACXuE"}