{"version":3,"file":"index.bd13d0d1.js","sources":["../../src/views/Login/index.vue"],"sourcesContent":["<template>\n  <div class=\"login\">\n    <div class=\"login-bk\">\n      <div class=\"login-bk-shadow\"></div>\n    </div>\n\n    <div class=\"login-container\">\n      <el-form\n        ref=\"userLoginForm\"\n        :model=\"formModel\"\n        :rules=\"formRules\"\n        class=\"login-form\"\n        label-position=\"left\"\n      >\n        <el-form-item prop=\"username\">\n          <el-input\n            v-model=\"formModel.username\"\n            prefix-icon=\"el-icon-user\"\n            placeholder=\"用户名\"\n          />\n        </el-form-item>\n\n        <el-form-item prop=\"password\">\n          <el-input\n            v-model=\"formModel.password\"\n            show-password\n            prefix-icon=\"el-icon-lock\"\n            placeholder=\"密码\"\n          >\n          </el-input>\n        </el-form-item>\n\n        <el-form-item>\n          <el-button\n            :loading=\"loading\"\n            type=\"primary\"\n            class=\"login-btn\"\n            @click.prevent=\"handleLogin\"\n          >\n            登录\n          </el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {\n  ref,\n  toRefs,\n  reactive,\n  defineComponent,\n  onMounted,\n  onUnmounted,\n} from \"vue\";\nimport { useRoute, useRouter } from \"vue-router\";\nimport { ElMessage } from \"element-plus\";\n\nconst initFormFields = () => {\n  return {\n    username: \"\",\n    password: \"\",\n  };\n};\nexport default defineComponent({\n  name: \"Login\",\n  setup() {\n    const router = useRouter();\n    const route = useRoute();\n\n    const userLoginForm = ref(null);\n\n    const state = reactive({\n      redirect: \"\",\n      formModel: initFormFields(),\n      formRules: {\n        username: [\n          {\n            required: true,\n            message: \"用户名不能为空\",\n            trigger: \"blur\",\n          },\n        ],\n        password: [\n          {\n            required: true,\n            message: \"密码不能为空\",\n            trigger: \"blur\",\n          },\n        ],\n      },\n      loading: false,\n    });\n\n    onMounted(() => {});\n\n    onUnmounted(() => {});\n\n    // watch(()=>route,()=>{\n    //     const query = route.query;\n    //     if (query) {\n    //       state.redirect = query.redirect;\n    //     }\n    // })\n\n    const resetFormFields = () => {\n      state.formModel = initFormFields();\n      userLoginForm.value.resetFields();\n    };\n\n    const handleLogin = () => {\n      const { username, password } = state.formModel;\n      const params = {\n        username,\n        password,\n      };\n\n      userLoginForm.value.validate((valid) => {\n        if (valid) {\n          state.loading = true;\n          store\n            .dispatch(\"user/login\", params)\n            .then((res) => {\n              if (+res.code === 0) {\n                ElMessage.success(\"登录成功\");\n                router.push({ path: state.redirect || \"/\" });\n              } else {\n                ElMessage.error(res.message || \"登录错误\");\n              }\n              state.loading = false;\n            })\n            .catch(() => {\n              state.loading = false;\n            });\n        } else {\n          console.log(\"invalid form\");\n          return false;\n        }\n      });\n    };\n\n    return {\n      ...toRefs(state),\n      userLoginForm,\n      resetFormFields,\n      handleLogin,\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"./index.scss\";\n</style>\n"],"names":["defineComponent","name","[object Object]","router","useRouter","userLoginForm","ref","state","reactive","redirect","formModel","username","password","formRules","required","message","trigger","loading","toRefs","resetFormFields","value","resetFields","handleLogin","params","validate","valid","log","dispatch","then","res","code","success","push","path","error","catch","_hoisted_2","model","_ctx","rules","class","onUpdate:modelValue","prefix-icon","show-password","type"],"mappings":"oeA2DA,QAMkBA,GAChBC,KAAM,QACNC,cACQC,EAASC,cAGTC,EAAgBC,EAAI,MAEpBC,EAAQC,EAAS,CACrBC,SAAU,GACVC,UAfG,CACLC,SAAU,GACVC,SAAU,IAcRC,UAAW,CACTF,SAAU,CACR,CACEG,UAAU,EACVC,QAAS,UACTC,QAAS,SAGbJ,SAAU,CACR,CACEE,UAAU,EACVC,QAAS,SACTC,QAAS,UAIfC,SAAS,OAGD,YAEE,yIA8CPC,EAAOX,UADL,CAELF,cAAAA,EACAc,gBAvCsB,OAChBT,UA/CH,CACLC,SAAU,GACVC,SAAU,MA8CMQ,MAAMC,eAsCpBC,YAnCkB,WACZX,SAAEA,WAAUC,GAAaL,EAAMG,UAC/Ba,EAAS,CACbZ,SAAAA,EACAC,SAAAA,KAGYQ,MAAMI,UAAUC,QACxBA,iBAiBMC,IAAI,iBACL,IAjBDT,SAAU,QAEbU,SAAS,aAAcJ,GACvBK,MAAMC,IACa,IAAbA,EAAIC,QACGC,QAAQ,UACXC,KAAK,CAAEC,KAAM1B,EAAME,UAAY,SAE5ByB,MAAML,EAAId,SAAW,UAE3BE,SAAU,KAEjBkB,OAAM,OACClB,SAAU,yFAlII,4NAG9BmB,kBAGK9B,IAAK,gBACL+B,MAAOC,YACRC,MAAMD,YACNE,yIAKIC,6DACAC,4JAOAD,6DACAE,mBACAD,8GAQAzB,kBACA2B,eACCJ,MAAK"}